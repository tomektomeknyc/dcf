flowchart LR
  %% ---- Hub ----
  HUB["dcf-main: Streamlit orchestrator<br/>dcf-main.app"]:::hub

  %% ---- Groups ----
  subgraph UI["UI"]
    ui_app["dcf-main_app"]
    ui_app_mob["dcf-main_app_mobile_optimized"]
    ui_capm["dcf-main_capm"]
    ui_dcf_val["dcf-main_dcf_valuation"]
    ui_fama["dcf-main_fama_french"]
    ui_fcf["dcf-main_fcf_calculations"]
    ui_fetch_betas["dcf-main_fetch_damodaran_betas"]
    ui_fin_report["dcf-main_fin_report_tab"]
    ui_fin_down["dcf-main_fin_stat_downloader"]
    ui_proj_desc["dcf-main_project_description_tab"]
    ui_qa["dcf-main_qa_engine_QnA"]
    ui_qa_tab["dcf-main_qa_tab"]
    ui_scrape_ff5["dcf-main_scrape_ff5"]
    ui_stock_rend["dcf-main_stock_analysis_renderer"]
    ui_stock_ret["dcf-main_stock_returns"]
  end

  subgraph EN["Engines"]
    eng_bridge["dcf-main_bridge_adapter"]
    eng_connectors["dcf-main_connectors_aws_min"]
    eng_ev["dcf-main_ev_ebitda"]
    eng_excel["dcf-main_excel_bridge"]
    eng_fcfe["dcf-main_fcfe"]
    eng_gen_report["dcf-main_generate_report"]
    eng_hedge_prompt["dcf-main_hedge_prompt"]
    eng_metrics["dcf-main_metrics"]
    eng_news["dcf-main_news_fetcher"]
    eng_reg["dcf-main_regression_engine"]
    eng_test["dcf-main_test_bridge"]
    eng_wacc["dcf-main_wacc_engine"]
  end

  subgraph DATA["Data"]
    data_gate["dcf-main_data_gatekeeper"]
    data_fin_load["dcf-main_finance_data_loader"]
    data_hist["dcf-main_historical_data_extractor"]
    data_risk["dcf-main_risk_hedge"]
    data_debug["dcf-main_debug_airnz"]
  end

  subgraph MOD["Modules"]
    mod_ocr["dcf-main_ocr_image_pdf"]
    mod_pdf["dcf-main_pdf_text"]
    mod_ind["dcf-main_ticker_to_industry"]
    mod_reg["dcf-main_ticker_to_region"]
    mod_vid["dcf-main_video_transcribe"]
    mod_web["dcf-main_web_scraper"]
  end

  subgraph DB["Database"]
    db_engine["dcf-main_db_engine"]
    db_models["dcf-main_db_models"]
    db_init["dcf-main_db___init__"]
  end

  %% ---- Wiring: connect hub to group nodes (compact form) ----
  HUB --> ui_app & ui_app_mob & ui_capm & ui_dcf_val & ui_fama & ui_fcf & ui_fetch_betas & ui_fin_report & ui_fin_down & ui_proj_desc & ui_qa & ui_qa_tab & ui_scrape_ff5 & ui_stock_rend & ui_stock_ret

  HUB --> eng_bridge & eng_connectors & eng_ev & eng_excel & eng_fcfe & eng_gen_report & eng_hedge_prompt & eng_metrics & eng_news & eng_reg & eng_test & eng_wacc

  HUB --> data_gate & data_fin_load & data_hist & data_risk & data_debug

  HUB --> mod_ocr & mod_pdf & mod_ind & mod_reg & mod_vid & mod_web

  HUB --> db_engine & db_models & db_init

  %% Keep your original DB edge
  db_engine --> db_models

  %% ---- Minimal styling that GitHub supports ----
  classDef hub fill:#ffffff,stroke:#0ea5e9,stroke-width:2px,font-weight:bold,color:#0ea5e9;
